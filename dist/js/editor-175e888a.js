var tt=Object.defineProperty;var et=(e,t,o)=>t in e?tt(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o;var O=(e,t,o)=>(et(e,typeof t!="symbol"?t+"":t,o),o);import{d as ot}from"./pinia-c946f11f.js";import{g as N,r as nt,w as L,s as F,p as at,b as st}from"./index-a3536f0a.js";import{g as rt,b as it,c as lt,d as ct,t as ut}from"./config-d96f08a4.js";import{q as p,c as v,r as k,a as _,b as pt}from"./index-5e3b3a36.js";import{r as f,av as A,J as mt,b as ft,n as ht}from"./@vue-c6fcbc26.js";const h=N,b=F,$="custom-css-style",K="custom-markdown-primary-color",q="custom_markdown_primary_bg_color",j="markdown-font",W="ADJUST_RESUME_MARGIN_TOP",H="auto-one-page",U="white-space",G="Line_Height",S=1123;f();const dt=f(90),gt=f(1);function Dt(e){dt.value=e}function x(){return document.querySelector(".reference-dom")}function Ot(e){async function t(o){const r=o.target.files[0],s=new FileReader;s.readAsDataURL(r),s.onload=function(n){var a;e("upload-avatar",(a=n.target)==null?void 0:a.result)}}return{setAvatar:t}}function Pt(e){const t=f(!1),o=$+"-"+e,r=f(h(o)?h(o):"");function s(){t.value=!t.value}function n(){var l;t.value=!1;let i=p(o);const c=r.value.trim(),m=i;!r.value||(i||(i=v(),i.setAttribute(o,"true")),i.textContent=c,!m&&((l=document.head)==null||l.appendChild(i)),b(o,c))}function a(){t.value=!1,k(o),nt(o),r.value=""}return A(()=>!p(o)&&setTimeout(n,50)),{cssDialog:t,cssText:r,toggleDialog:s,setStyle:n,removeStyle:a}}function _t(e){const t=q+"-"+e,o=rt(e),r=f(h(t)?h(t):o);function s(n){n||(r.value=o,n=o);let a=p(t);const i=a;a||(a=v(),a.setAttribute(t,"true")),a.textContent=`:root { --markdown-primary-bg-color: ${n}; }`,!i&&document.head.appendChild(a),b(t,n)}return A(()=>!p(t)&&s(r.value)),{primaryColor:r,setPrimaryColor:s}}function Ht(e){const t=K+"-"+e,o=it(e),r=f(h(t)?h(t):o);function s(n){n||(r.value=o,n=o);let a=p(t);const i=a;a||(a=v(),a.setAttribute(t,"true")),a.textContent=`:root { --markdown-primary-color: ${n} }`,!i&&document.head.appendChild(a),b(t,n)}return A(()=>!p(t)&&s(r.value)),{color:r,setColor:s}}function It(e){const t=j+"-"+e,o=[{value:"Noto Serif SC",label:"Noto Serif SC"},{value:"Noto Sans SC",label:"Noto Sans SC"},{value:"Nunito",label:"Nunito(\u82F1\u6587)"}],r=f(h(t)?h(t):lt(e)||o[0].value);function s(n,a){let i=p(t);const c=i;i||(i=v(),i.setAttribute(t,"true")),i.textContent=`.jufe * { font-family: ${n}, 'Noto Sans SC', 'Noto Serif SC', 'Nunito', sans-serif, serif; }`,!c&&document.head.appendChild(i),b(t,n);const m=x();E(m),!a&&D(m)}return A(()=>s(r.value,!0)),{fontOptions:o,font:r,setFont:s}}function Lt(e){localStorage.removeItem(`${$}-${e}`),localStorage.removeItem(`${K}-${e}`),localStorage.removeItem(`${q}-${e}`),localStorage.removeItem(`${j}-${e}`),localStorage.removeItem(`${H}-${e}`),localStorage.removeItem(`${W}-${e}`),localStorage.removeItem(`${G}-${e}`),localStorage.removeItem(`markdown-content-${e}`),location.reload()}function Rt(e){const t=f(!1),o=mt([]),r=W+"-"+e;function s(l){const u=[],g=new Set,C=new Set;function d(y){if(y!==l){const w=window.getComputedStyle(y),X=parseInt(w.marginTop),Z=parseInt(w.marginBottom),M=y.tagName.toLowerCase(),B=y.className.split(" ")[0]||"",z=pt(B||M);(!g.has(M)||!C.has(B))&&(u.push({tagName:M,name:z,marginBottom:Z,marginTop:X,className:B}),g.add(M),C.add(B))}const I=y.children;for(let w=0;w<I.length;w++)d(I[w])}return d(l),u}function n(){c();const l=x(),u=s(l);o.length=0,o.push(...u)}function a(){c();let l=p(r),u="";const g=l;l||(l=v(),l.setAttribute(r,"true"));for(const d of o){const y=d.className?`.${d.className}`:d.tagName;u+=`.jufe ${y} {margin-top: ${d.marginTop}px!important; margin-bottom: ${d.marginBottom}px!important;}`}l.textContent=u,i(g,l),b(r,u);const C=x();E(C),D(C)}function i(l,u){if(!l){const g=p(H+"-"+e),C=p($+"-"+e);if(g||C){const d=g||C;document.head.insertBefore(u,d)}else document.head.appendChild(u)}}function c(){t.value=!t.value}function m(){const l=h(r)||"";if(!l)return;let u=p(r);const g=u;u||(u=v(),u.setAttribute(r,"true")),u.textContent=l,i(g,u)}return A(()=>!p(r)&&m()),{adjustMargin:n,visible:t,confirmAdjustment:a,properties:o}}function Tt(e){const t=G+"-"+e,o=f(h(t)?+h(t):+ct(e)),r=Array(30).fill(0).map((n,a)=>({label:`${10+a}px`,value:10+a}));function s(n,a){o.value=n;let i=p(t);const c=i;i||(i=v(),i.setAttribute(t,"true")),i.textContent=`.markdown-transform-html * { line-height: ${n}px; }`,!c&&document.head.appendChild(i),b(t,n);const m=x();E(m),!a&&D(m)}return A(()=>s(o.value,!0)),{h:o,lineHeightOptions:r,setLineHeight:s}}function kt(){const e=f(!1);let t=null;function o(){if(!e.value)return null;const s=document.querySelector(".writable-edit-mode"),n=document.querySelector(".cm-scroller"),a=document.querySelector(".markdown-render");function i(){e.value&&(a.scrollTop=a.scrollHeight*(s.scrollTop/s.scrollHeight))}function c(){e.value&&(a.scrollTop=a.scrollHeight*(n.scrollTop/n.scrollHeight))}return n==null||n.addEventListener("scroll",c),s==null||s.addEventListener("scroll",i),()=>{s==null||s.removeEventListener("scroll",i),n==null||n.removeEventListener("scroll",c)}}function r(){t&&t(),t=o()}return ft(r),{followRoll:e,setFollowRoll:r}}function J(e){const t=getComputedStyle(e),o=e.clientHeight,r=+t.getPropertyValue("margin-top").slice(0,-2)+ +t.getPropertyValue("margin-bottom").slice(0,-2);return o+r}function Y(e,t){let o=e.offsetTop,r=e.offsetParent;for(;r!==t;)o+=r.offsetTop,r=r.offsetParent;return o}function D(e){Ct(e);let t=0,o=0;const r=e.clientHeight,s=document.querySelector(".re-render");for(s.innerHTML="";r-o>0;){const n=_(),a=e.cloneNode(!0);n.classList.add("jufe-wrapper-page");const i=Math.min(r-o,S),c=_();c.classList.add("jufe-wrapper-page-item"),c.style.height=i+"px",a.style.position="absolute",a.style.top=-t*S+"px",a.style.left=0+"px",c.appendChild(a),n.appendChild(c),o+=S,t++,s==null||s.appendChild(n)}gt.value=t}function E(e){const t=Array.from(e.children);for(const o of t)o.getAttribute(U)?e.removeChild(o):E(o)}function V(e){const t=_();return t.setAttribute(U,"true"),t.style.height=e+"px",t}function Ct(e){const t=+getComputedStyle(e).getPropertyValue("padding-top").slice(0,-2),o=+getComputedStyle(e).getPropertyValue("padding-bottom").slice(0,-2),r=Array.from(e.children),s={value:1};for(const n of r){const a=J(n),i=Y(n,e);i+a>S*s.value-o&&(n.children.length?Q(n,e,t,o,s):(e.insertBefore(V(S*s.value-i+t),n),++s.value))}return e}function Q(e,t,o,r,s){const n=Array.from(e.children);for(const a of n){const i=J(a),c=Y(a,t);c+i>S*s.value-r&&(a.children.length&&!["p","li","table"].includes(a.tagName.toLocaleLowerCase())?Q(a,t,o,r,s):(e.insertBefore(V(S*s.value-c+o),a),s.value++))}}function Kt(e){const t=H+"-"+e,o=f(N(t));async function r(s){const n=x();if(E(n),o.value){const a=S-(n==null?void 0:n.clientHeight);if(a<0&&a<-200){L("\u4F60\u7684\u5185\u5BB9\u6709\u70B9\u592A\u591A\u5566\uFF01\u538B\u7F29\u6210\u4E00\u9875\u7684\u8BDD\u4E0D\u592A\u7F8E\u89C2\u54E6\uFF5E");return}if(a>0&&a>500){L("\u4F60\u7684\u5185\u5BB9\u6709\u70B9\u592A\u5C11\u4E86\uFF01\u538B\u7F29\u6210\u4E00\u9875\u7684\u8BDD\u4E0D\u592A\u7F8E\u89C2\u54E6\uFF0C\u518D\u586B\u5199\u4E00\u70B9\u5185\u5BB9\u5427\uFF5E");return}const{differenceConfig:i,map:c}=St(n);wt(i,a,c,t,e)}else k(t);F(t,o.value),!s&&D(n)}return A(()=>!p(t)&&setTimeout(()=>r(!0),50)),{autoOnePage:o,setAutoOnePage:r}}function St(e){const t=Array.from(e.querySelectorAll("h1,h2,h3,h4,h5,h6,li,p")),o=[],r=new Set,s=new Map;for(const n of t){const a=n.tagName.toLowerCase();if(s.set(a,(s.get(a)||0)+1),r.has(a))continue;r.add(a);const i=+getComputedStyle(n,null).marginTop.slice(0,-2),c={...vt[a],top:i,tag:a},m=c.top/c.max;c.optimal=m,o.push(c)}return{differenceConfig:o,map:s}}const vt={h1:{max:30,min:-15,top:0,tag:"",optimal:0},h2:{max:30,min:-15,top:0,tag:"",optimal:0},h3:{max:20,min:-15,top:0,tag:"",optimal:0},h4:{max:20,min:-15,top:0,tag:"",optimal:0},h5:{max:20,min:-15,top:0,tag:"",optimal:0},h6:{max:20,min:-15,top:0,tag:"",optimal:0},li:{max:10,min:-15,top:0,tag:"",optimal:0},p:{max:10,min:-15,top:0,tag:"",optimal:0}},yt=(e,t)=>e.optimal>t.optimal,P=(e,t,o)=>[e[t],e[o]]=[e[o],e[t]];class At{constructor(t){O(this,"container",[]);O(this,"cmp",yt);this.cmp=t}push(t){const{container:o,cmp:r}=this;o.push(t);let s=o.length-1;for(;s;){const n=Math.floor((s-1)/2);if(!r(o[s],o[n]))return;P(o,s,n),s=n}}pop(){const{container:t,cmp:o}=this;if(!t.length)return null;P(t,0,t.length-1);const r=t.pop(),s=t.length;let n=0,a=n*2+1;for(;a<s;){const i=n*2+2;if(i<s&&o(t[i],t[a])&&(a=i),!o(t[a],t[n]))break;P(t,a,n),n=a,a=n*2+1}return r}top(){return this.container.length?this.container[0]:null}isEmpty(){return this.container.length===0}}function wt(e,t,o,r,s){const n=new At((l,u)=>t<0?l.optimal>u.optimal:l.optimal<u.optimal);for(const l of e)n.push(l);if(t<0)for(;t++<20;){const l=n.pop();l.top=l.top-1/(o.get(l.tag)||1),l.optimal=l.top/l.max,n.push(l)}else for(;t-- >20;){const l=n.pop();l.top=l.top+1/(o.get(l.tag)||1),l.optimal=l.top/l.max,n.push(l)}const a=v(),i=".jufe ";let c="";a.setAttribute(r,"true");for(const l of n.container)c+=`${i}${l.tag} { margin-top: ${l.top}px!important; }`;a.textContent=c;const m=p($+"-"+s);m?document.head.insertBefore(a,m):document.head.appendChild(a)}const R="markdown-content",T="writable",bt=e=>{for(const t of ut.value)if(e===t.type)return t.content;return""},Et=ot("editorStore",{state:()=>({MDContent:"",nativeContent:"",writable:Boolean(N(T))||!1}),actions:{initMDContent(e){const t=R+"-"+e;this.MDContent=N(t)?N(t):bt(e)},setMDContent(e,t){this.MDContent=e,e&&F(`${R}-${t}`,e)},setWritableMode(e){this.writable=!this.writable,F(T,this.writable),st("\u60A8\u5DF2\u5207\u6362\u81F3",this.writable?"\u5185\u5BB9\u6A21\u5F0F":"Markdown\u6A21\u5F0F"),this.writable&&ht(()=>{e=e||document.querySelector(".reference-dom"),e=e.cloneNode(!0);const t=document.querySelector(".writable-edit-mode");E(e),t&&(t.innerHTML=e.innerHTML)})},setNativeContent(e){this.nativeContent=e},resetNativeContent(){this.nativeContent=""}}}),qt=()=>Et(at);export{W as A,K as C,G as L,j as M,q as a,H as b,$ as c,Kt as d,E as e,Pt as f,Ht as g,It as h,_t as i,Rt as j,kt as k,Tt as l,dt as m,Dt as n,Ot as o,gt as p,Lt as r,D as s,qt as u};
